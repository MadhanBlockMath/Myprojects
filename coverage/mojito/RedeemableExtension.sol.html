<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for mojito/RedeemableExtension.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">mojito/</a> RedeemableExtension.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/34</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/20</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/35</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
&nbsp;
pragma solidity ^0.8.0;
&nbsp;
import "../manifold/libraries-solidity/access/AdminControl.sol";
import "../manifold/creator-core/core/IERC721CreatorCore.sol";
import "../openzeppelin/utils/math/SafeMath.sol";
import "../openzeppelin/utils/cryptography/ECDSA.sol";
&nbsp;
contract RedeemableExtension is AdminControl {
    using SafeMath for uint256;
    using ECDSA for bytes32;
&nbsp;
    address public CREATOR_CONTRACT;
    uint256 public MAX_CAP = 0;
    uint256 public TOTAL_TOKENS = 0;
    mapping(bytes32 =&gt; bool) public voucherIsRedeemed;
&nbsp;
    // Mapping from token ID to boolean flag to identify the redeemed status
    mapping(uint256 =&gt; bool) public tokenIsRedeemed;
&nbsp;
    // Boolean for contract pause status
    bool public paused = false;
&nbsp;
    struct Voucher {
        bytes32 id;
        uint16 numberOfTokens;
        address redeemer;
        bytes signature;
    }
&nbsp;
    // Event log to emit when the token is redeemed
    event TokenRedeemed(uint256 tokenId);
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier notPaused() {</span>
<span class="cstat-no" title="statement not covered" >        require(!paused, "Contract is paused.")</span>;
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    constructor(address creator, uint256 maxCap) {</span>
<span class="cstat-no" title="statement not covered" >        CREATOR_CONTRACT = creator</span>;
<span class="cstat-no" title="statement not covered" >        MAX_CAP = maxCap</span>;
    }
&nbsp;
    /**
     * @notice Set paused to true
     * @dev Can only be done by Admin
     */
<span class="fstat-no" title="function not covered" >    function unpauseContract() external adminRequired {</span>
<span class="cstat-no" title="statement not covered" >        paused = false</span>;
    }
&nbsp;
    /**
     * @notice Set paused to false
     * @dev Can only be done by Admin
     */
<span class="fstat-no" title="function not covered" >    function pauseContract() external adminRequired notPaused {</span>
<span class="cstat-no" title="statement not covered" >        paused = true</span>;
    }
&nbsp;
    /**
     * @notice Mint `numberOfTokens` to `mintTo` address
     * @dev Can only be done by Admin
     */
<span class="fstat-no" title="function not covered" >    function mintBatch(address mintTo, uint16 numberOfTokens)</span>
        external
        adminRequired
        notPaused
        returns (uint256[] memory)
    {
<span class="cstat-no" title="statement not covered" >        require(numberOfTokens &gt; 0, "Need to mint at least 1 token.")</span>;
<span class="cstat-no" title="statement not covered" >        require(</span>
            TOTAL_TOKENS.add(uint256(numberOfTokens)) &lt;= MAX_CAP,
            "Cannot exceed max supply of available tokens."
        );
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256[] memory tokens = IERC721CreatorCore(CREATOR_CONTRACT)</span>
            .mintExtensionBatch(mintTo, numberOfTokens);
<span class="cstat-no" title="statement not covered" >        TOTAL_TOKENS += numberOfTokens</span>;
<span class="cstat-no" title="statement not covered" >        return tokens;</span>
    }
&nbsp;
    /**
     * @notice Mint a to `mintTo` address
     * @dev Can only be done by Admin
     */
<span class="fstat-no" title="function not covered" >    function mint(address mintTo) external adminRequired notPaused returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        require(</span>
            TOTAL_TOKENS.add(1) &lt;= MAX_CAP,
            "Cannot exceed max supply of available tokens."
        );
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 tokenId = IERC721CreatorCore(CREATOR_CONTRACT).mintExtension(mintTo);</span>
<span class="cstat-no" title="statement not covered" >        TOTAL_TOKENS += 1</span>;
<span class="cstat-no" title="statement not covered" >        return tokenId;</span>
    }
&nbsp;
    /**
     * @notice Update extension's baseURI
     * @dev Can only be done by Admin
     */
<span class="fstat-no" title="function not covered" >    function setBaseURI(string memory baseURI_) external adminRequired {</span>
<span class="cstat-no" title="statement not covered" >        IERC721CreatorCore(CREATOR_CONTRACT).setBaseTokenURIExtension(baseURI_)</span>;
    }
&nbsp;
    /**
     * @notice Redeems a voucher
     * @param voucher A signed voucher containing minting info
     */
<span class="fstat-no" title="function not covered" >    function redeem(Voucher calldata voucher)</span>
        public
        notPaused
        returns (uint256[] memory)
    {
<span class="cstat-no" title="statement not covered" >        require(voucher.numberOfTokens &gt; 0, "Need to mint at least 1 token.")</span>;
<span class="cstat-no" title="statement not covered" >        require(</span>
            TOTAL_TOKENS.add(uint256(voucher.numberOfTokens)) &lt;= MAX_CAP,
            "Cannot exceed max supply of available tokens."
        );
<span class="cstat-no" title="statement not covered" >        require(!voucherIsRedeemed[voucher.id], "Voucher has already been redeemed")</span>;
&nbsp;
        // get the address that signed the voucher
<span class="cstat-no" title="statement not covered" >        address signer = getVoucherSigner(voucher);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(this.isAdmin(signer),  "Signature invalid or signer is not an admin" )</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        voucherIsRedeemed[voucher.id] = true</span>;
<span class="cstat-no" title="statement not covered" >        uint256[] memory tokens;</span>
        
<span class="cstat-no" title="statement not covered" >        if (voucher.numberOfTokens&gt;=5){</span>
<span class="cstat-no" title="statement not covered" >            for (uint256 i = 0; i &lt; voucher.numberOfTokens; i++) {</span>
<span class="cstat-no" title="statement not covered" >            tokens[i] = IERC721CreatorCore(CREATOR_CONTRACT).mintExtension(voucher.redeemer)</span>;
            }
        }else{
<span class="cstat-no" title="statement not covered" >            tokens = IERC721CreatorCore(CREATOR_CONTRACT)</span>
            .mintExtensionBatch(voucher.redeemer, voucher.numberOfTokens);
        }
<span class="cstat-no" title="statement not covered" >        TOTAL_TOKENS += voucher.numberOfTokens</span>;
<span class="cstat-no" title="statement not covered" >        return tokens;</span>
    }
&nbsp;
    /**
     * @notice Verifies the signature for a given Voucher, returning the address of the signer.
     * @param voucher A signed voucher containing minting info
     */
<span class="fstat-no" title="function not covered" >    function getVoucherSigner(Voucher calldata voucher) public view returns (address) {</span>
<span class="cstat-no" title="statement not covered" >        bytes32 digest = getVoucherDigest(voucher);</span>
<span class="cstat-no" title="statement not covered" >        return digest.recover(voucher.signature);</span>
    }
&nbsp;
    /**
     * @notice Returns hash of Voucher
     * @param voucher A signed voucher containing minting info
     */
<span class="fstat-no" title="function not covered" >    function getVoucherDigest(Voucher calldata voucher) public view returns (bytes32) {</span>
<span class="cstat-no" title="statement not covered" >        return keccak256(</span>
            abi.encode(
                voucher.id,
                voucher.numberOfTokens,
                voucher.redeemer,
                address(this)
            )
        );
    }
&nbsp;
    /**
     * @dev Makes the token status to redeemed. It can not be go back to false again.
     * @param tokenId - Token Identifier
     * 
     * Requirement
     * - `tokenId` can not be redeemed again if already redeemed by the owner
     * - Only the admin can redeem the tokens
     * 
     * Emits a {TokenRedeemed} event.
     */
<span class="fstat-no" title="function not covered" >    function redeemToken(uint256 tokenId) external adminRequired notPaused{</span>
<span class="cstat-no" title="statement not covered" >        require(!tokenIsRedeemed[tokenId], "Token already redeemed")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        tokenIsRedeemed[tokenId] = true</span>;
<span class="cstat-no" title="statement not covered" >        emit TokenRedeemed(tokenId);</span>
    }
&nbsp;
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Jul 19 2022 17:28:17 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
