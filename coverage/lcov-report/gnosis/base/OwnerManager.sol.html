<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for gnosis/base/OwnerManager.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">gnosis/base/</a> OwnerManager.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/50</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/36</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/53</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: LGPL-3.0-only
pragma solidity &gt;=0.7.0 &lt;0.9.0;
import "../common/SelfAuthorized.sol";
&nbsp;
/// @title OwnerManager - Manages a set of owners and a threshold to perform actions.
/// @author Stefan George - &lt;stefan@gnosis.pm&gt;
/// @author Richard Meissner - &lt;richard@gnosis.pm&gt;
contract OwnerManager is SelfAuthorized {
&nbsp;
    event AddedOwner(address owner);
    event RemovedOwner(address owner);
    event ChangedThreshold(uint256 threshold);
&nbsp;
    address internal constant SENTINEL_OWNERS = address(0x1);
&nbsp;
    mapping(address =&gt; address) internal owners;
    uint256 ownerCount;
    uint256 internal threshold;
&nbsp;
    /// @dev Setup function sets initial storage of contract.
    /// @param _owners List of Safe owners.
    /// @param _threshold Number of required confirmations for a Safe transaction.
<span class="fstat-no" title="function not covered" >    function setupOwners(address[] memory _owners, uint256 _threshold)</span>
        internal
    {
        // Threshold can only be 0 at initialization.
        // Check ensures that setup function can only be called once.
<span class="cstat-no" title="statement not covered" >        require(threshold == 0, "GS200")</span>;
        // Validate that threshold is smaller than number of added owners.
<span class="cstat-no" title="statement not covered" >        require(_threshold &lt;= _owners.length, "GS201")</span>;
        // There has to be at least one Safe owner.
<span class="cstat-no" title="statement not covered" >        require(_threshold &gt;= 1, "GS202")</span>;
        // Initializing Safe owners.
<span class="cstat-no" title="statement not covered" >        address currentOwner = SENTINEL_OWNERS;</span>
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; _owners.length; i++) {</span>
            // Owner address cannot be null.
<span class="cstat-no" title="statement not covered" >            address owner = _owners[i];</span>
<span class="cstat-no" title="statement not covered" >            require(owner != address(0) &amp;&amp; owner != SENTINEL_OWNERS &amp;&amp; owner != address(this) &amp;&amp; currentOwner != owner, "GS203")</span>;
            // No duplicate owners allowed.
<span class="cstat-no" title="statement not covered" >            require(owners[owner] == address(0), "GS204")</span>;
<span class="cstat-no" title="statement not covered" >            owners[currentOwner] = owner</span>;
<span class="cstat-no" title="statement not covered" >            currentOwner = owner</span>;
        }
<span class="cstat-no" title="statement not covered" >        owners[currentOwner] = SENTINEL_OWNERS</span>;
<span class="cstat-no" title="statement not covered" >        ownerCount = _owners.length</span>;
<span class="cstat-no" title="statement not covered" >        threshold = _threshold</span>;
    }
&nbsp;
    /// @dev Allows to add a new owner to the Safe and update the threshold at the same time.
    ///      This can only be done via a Safe transaction.
    /// @notice Adds the owner `owner` to the Safe and updates the threshold to `_threshold`.
    /// @param owner New owner address.
    /// @param _threshold New threshold.
<span class="fstat-no" title="function not covered" >    function addOwnerWithThreshold(address owner, uint256 _threshold)</span>
        public
        authorized
    {
        // Owner address cannot be null, the sentinel or the Safe itself.
<span class="cstat-no" title="statement not covered" >        require(owner != address(0) &amp;&amp; owner != SENTINEL_OWNERS &amp;&amp; owner != address(this), "GS203")</span>;
        // No duplicate owners allowed.
<span class="cstat-no" title="statement not covered" >        require(owners[owner] == address(0), "GS204")</span>;
<span class="cstat-no" title="statement not covered" >        owners[owner] = owners[SENTINEL_OWNERS]</span>;
<span class="cstat-no" title="statement not covered" >        owners[SENTINEL_OWNERS] = owner</span>;
        ownerCount++;
<span class="cstat-no" title="statement not covered" >        emit AddedOwner(owner);</span>
        // Change threshold if threshold was changed.
<span class="cstat-no" title="statement not covered" >        if (threshold != _threshold)</span>
<span class="cstat-no" title="statement not covered" >            changeThreshold(_threshold)</span>;
    }
&nbsp;
    /// @dev Allows to remove an owner from the Safe and update the threshold at the same time.
    ///      This can only be done via a Safe transaction.
    /// @notice Removes the owner `owner` from the Safe and updates the threshold to `_threshold`.
    /// @param prevOwner Owner that pointed to the owner to be removed in the linked list
    /// @param owner Owner address to be removed.
    /// @param _threshold New threshold.
<span class="fstat-no" title="function not covered" >    function removeOwner(address prevOwner, address owner, uint256 _threshold)</span>
        public
        authorized
    {
        // Only allow to remove an owner, if threshold can still be reached.
<span class="cstat-no" title="statement not covered" >        require(ownerCount - 1 &gt;= _threshold, "GS201")</span>;
        // Validate owner address and check that it corresponds to owner index.
<span class="cstat-no" title="statement not covered" >        require(owner != address(0) &amp;&amp; owner != SENTINEL_OWNERS, "GS203")</span>;
<span class="cstat-no" title="statement not covered" >        require(owners[prevOwner] == owner, "GS205")</span>;
<span class="cstat-no" title="statement not covered" >        owners[prevOwner] = owners[owner]</span>;
<span class="cstat-no" title="statement not covered" >        owners[owner] = address(0)</span>;
        ownerCount--;
<span class="cstat-no" title="statement not covered" >        emit RemovedOwner(owner);</span>
        // Change threshold if threshold was changed.
<span class="cstat-no" title="statement not covered" >        if (threshold != _threshold)</span>
<span class="cstat-no" title="statement not covered" >            changeThreshold(_threshold)</span>;
    }
&nbsp;
    /// @dev Allows to swap/replace an owner from the Safe with another address.
    ///      This can only be done via a Safe transaction.
    /// @notice Replaces the owner `oldOwner` in the Safe with `newOwner`.
    /// @param prevOwner Owner that pointed to the owner to be replaced in the linked list
    /// @param oldOwner Owner address to be replaced.
    /// @param newOwner New owner address.
<span class="fstat-no" title="function not covered" >    function swapOwner(address prevOwner, address oldOwner, address newOwner)</span>
        public
        authorized
    {
        // Owner address cannot be null, the sentinel or the Safe itself.
<span class="cstat-no" title="statement not covered" >        require(newOwner != address(0) &amp;&amp; newOwner != SENTINEL_OWNERS &amp;&amp; newOwner != address(this), "GS203")</span>;
        // No duplicate owners allowed.
<span class="cstat-no" title="statement not covered" >        require(owners[newOwner] == address(0), "GS204")</span>;
        // Validate oldOwner address and check that it corresponds to owner index.
<span class="cstat-no" title="statement not covered" >        require(oldOwner != address(0) &amp;&amp; oldOwner != SENTINEL_OWNERS, "GS203")</span>;
<span class="cstat-no" title="statement not covered" >        require(owners[prevOwner] == oldOwner, "GS205")</span>;
<span class="cstat-no" title="statement not covered" >        owners[newOwner] = owners[oldOwner]</span>;
<span class="cstat-no" title="statement not covered" >        owners[prevOwner] = newOwner</span>;
<span class="cstat-no" title="statement not covered" >        owners[oldOwner] = address(0)</span>;
<span class="cstat-no" title="statement not covered" >        emit RemovedOwner(oldOwner);</span>
<span class="cstat-no" title="statement not covered" >        emit AddedOwner(newOwner);</span>
    }
&nbsp;
    /// @dev Allows to update the number of required confirmations by Safe owners.
    ///      This can only be done via a Safe transaction.
    /// @notice Changes the threshold of the Safe to `_threshold`.
    /// @param _threshold New threshold.
<span class="fstat-no" title="function not covered" >    function changeThreshold(uint256 _threshold)</span>
        public
        authorized
    {
        // Validate that threshold is smaller than number of owners.
<span class="cstat-no" title="statement not covered" >        require(_threshold &lt;= ownerCount, "GS201")</span>;
        // There has to be at least one Safe owner.
<span class="cstat-no" title="statement not covered" >        require(_threshold &gt;= 1, "GS202")</span>;
<span class="cstat-no" title="statement not covered" >        threshold = _threshold</span>;
<span class="cstat-no" title="statement not covered" >        emit ChangedThreshold(threshold);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getThreshold()</span>
        public
        view
        returns (uint256)
    {
<span class="cstat-no" title="statement not covered" >        return threshold;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function isOwner(address owner)</span>
        public
        view
        returns (bool)
    {
<span class="cstat-no" title="statement not covered" >        return owner != SENTINEL_OWNERS &amp;&amp; owners[owner] != address(0);</span>
    }
&nbsp;
    /// @dev Returns array of owners.
    /// @return Array of Safe owners.
<span class="fstat-no" title="function not covered" >    function getOwners()</span>
        public
        view
        returns (address[] memory)
    {
<span class="cstat-no" title="statement not covered" >        address[] memory array = new address[](ownerCount);</span>
&nbsp;
        // populate return array
<span class="cstat-no" title="statement not covered" >        uint256 index = 0;</span>
<span class="cstat-no" title="statement not covered" >        address currentOwner = owners[SENTINEL_OWNERS];</span>
<span class="cstat-no" title="statement not covered" >        while(currentOwner != SENTINEL_OWNERS) {</span>
<span class="cstat-no" title="statement not covered" >            array[index] = currentOwner</span>;
<span class="cstat-no" title="statement not covered" >            currentOwner = owners[currentOwner]</span>;
            index ++;
        }
<span class="cstat-no" title="statement not covered" >        return array;</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Jul 18 2022 12:17:17 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
